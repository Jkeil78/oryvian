{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="bi bi-download me-2"></i>{{ _('export_csv') }}</h4>
                <span class="badge bg-white text-primary">{{ item_ids|length }} {{ _('items') }}</span>
            </div>
            <div class="card-body">
                <form action="{{ url_for('main.media_bulk_export') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    {% for item_id in item_ids %}
                    <input type="hidden" name="item_ids" value="{{ item_id }}">
                    {% endfor %}

                    <div class="mb-4">
                        <label class="form-label fw-bold">{{ _('export_format') }}</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="format_csv" value="csv"
                                    checked onchange="toggleDelimiter()">
                                <label class="form-check-label" for="format_csv">CSV</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="format" id="format_excel"
                                    value="excel" onchange="toggleDelimiter()">
                                <label class="form-check-label" for="format_excel">Excel (.xlsx)</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4" id="delimiter_section">
                        <label class="form-label fw-bold">{{ _('csv_delimiter') }}</label>
                        <select name="delimiter" class="form-select">
                            <option value="comma">{{ _('comma') }}</option>
                            <option value="semicolon" selected>{{ _('semicolon') }}</option>
                            <option value="tab">{{ _('tab') }}</option>
                        </select>
                    </div>

                    <script>
                        function toggleDelimiter() {
                            const isCsv = document.getElementById('format_csv').checked;
                            document.getElementById('delimiter_section').style.display = isCsv ? 'block' : 'none';
                        }
                    </script>

                    <div class="mb-4">
                        <label class="form-label fw-bold">{{ _('fields_to_export') }}</label>
                        <div class="row g-3">
                            {% set fields = [
                            ('inventory_number', _('inventory_num')),
                            ('title', _('title')),
                            ('author_artist', _('author_artist')),
                            ('category', _('category')),
                            ('release_year', _('release_year')),
                            ('barcode', _('isbn_barcode')),
                            ('location', _('location')),
                            ('lent_to', _('lent_to')),
                            ('lent_at', _('since')),
                            ('description', _('description'))
                            ] %}
                            {% for field_id, field_name in fields %}
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="fields" value="{{ field_id }}"
                                        id="f_{{ field_id }}" checked>
                                    <label class="form-check-label" for="f_{{ field_id }}">
                                        {{ field_name }}
                                    </label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-1"></i>{{ _('cancel') }}
                        </a>
                        <button type="submit" class="btn btn-primary px-5">
                            <i class="bi bi-download me-2"></i>{{ _('export') }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}